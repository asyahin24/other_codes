<!DOCTYPE html>
<html>
<head>
<title>Minesweeper</title>
<style>
table {
  border-collapse: collapse;
}
td {
  width: 30px;
  height: 30px;
  border: 1px solid black;
  text-align: center;
  cursor: pointer;
}
.hidden {
  background-color: #ccc;
}
.revealed {
  background-color: #eee;
}
.mine {
  background-color: red;
}
.flag {
  background-color: yellow;
}
</style>
</head>
<body>

<h1>Minesweeper</h1>

<label for="rows">Rows:</label>
<select id="rows">
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
</select>

<label for="cols">Columns:</label>
<select id="cols">
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
</select>

<label for="mines">Mines:</label>
<input type="number" id="mines" min="1" max="225">

<button onclick="newGame()">New Game</button>

<table id="board"></table>

<script>
let rows, cols, numMines;
let board = [];
let revealed = [];
let flagged = [];

function newGame() {
  rows = parseInt(document.getElementById("rows").value);
  cols = parseInt(document.getElementById("cols").value);
  numMines = parseInt(document.getElementById("mines").value);

  if (numMines > rows * cols) {
    alert("Too many mines!");
    return;
  }

  createBoard();
  generateMines();
  calculateAdjacentMines();
  drawBoard();
}

function createBoard() {
  board = [];
  revealed = [];
  flagged = [];

  for (let i = 0; i < rows; i++) {
    board[i] = [];
    revealed[i] = [];
    flagged[i] = [];
    for (let j = 0; j < cols; j++) {
      board[i][j] = 0;
      revealed[i][j] = false;
      flagged[i][j] = false;
    }
  }
}

function generateMines() {
  let minesPlaced = 0;

  while (minesPlaced < numMines) {
    let row = Math.floor(Math.random() * rows);
    let col = Math.floor(Math.random() * cols);

    if (board[row][col] !== -1) {
      board[row][col] = -1;
      minesPlaced++;
    }
  }
}

function calculateAdjacentMines() {
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
      if (board[i][j] !== -1) {
        let count = 0;
        for (let x = -1; x <= 1; x++) {
          for (let y = -1; y <= 1; y++) {
            if (i + x >= 0 && i + x < rows && j + y >= 0 && j + y < cols) {
              if (board[i + x][j + y] === -1) {
                count++;
              }
            }
          }
        }
        board[i][j] = count;
      }
    }
  }
}

function drawBoard() {
  let table = document.getElementById("board");
  table.innerHTML = "";

  for (let i = 0; i < rows; i++) {
    let row = document.createElement("tr");
    for (let j = 0; j < cols; j++) {
      let cell = document.createElement("td");
      cell.className = "hidden";
      cell.addEventListener("click", function() {
        revealCell(i, j);
      });
      cell.addEventListener("contextmenu", function(event) {
        event.preventDefault();
        toggleFlag(i, j);
      });
      row.appendChild(cell);
    }
    table.appendChild(row);
  }
}

function revealCell(row, col) {
  if (revealed[row][col] || flagged[row][col]) {
    return;
  }

  revealed[row][col] = true;

  let cell = document.getElementById("board").rows[row].cells[col];
  let hiddenCells = 0;
  cell.className = "revealed";

  if (board[row][col] === -1) {
    gameOver();
  } else if (board[row][col] === 0) {
    // Propagate to neighboring cells
    propagateReveal(row, col);
  } else {
    cell.textContent = board[row][col];
  }
}

function propagateReveal(row, col) {
  for (let x = -1; x <= 1; x++) {
    for (let y = -1; y <= 1; y++) {
      if (row + x >= 0 && row + x < rows && col + y >= 0 && col + y < cols) {
        revealCell(row + x, col + y);
      }
    }
  }
}

function toggleFlag(row, col) {
  if (revealed[row][col]) {
    return;
  }

  flagged[row][col] = !flagged[row][col];

  let cell = document.getElementById("board").rows[row].cells[col];
  cell.className = flagged[row][col] ? "flag" : "hidden";
}

function checkWin() {
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
      if (!revealed[i][j]) {
        hiddenCells++;
      }
    }
  }

  if (hiddenCells === numMines) {
    alert("You Win!");
  }
}

function gameOver() {
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
      if (board[i][j] === -1) {
        let cell = document.getElementById("board").rows[i].cells[j];
        cell.className = "mine";
      }
    }
  }
  alert("Game Over!");
}

newGame();
</script>

</body>
</html>